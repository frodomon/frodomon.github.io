{% assign lang = page.lang | default: site.default_lang %}
{% assign t = site.data.translations[lang] %}

<nav class="breadcrumb" aria-label="Breadcrumb">
  <!-- HOME -->
   <a href="{% if lang == 'es' %}/es/{% else %}/{% endif %}">{{ t.labels.home }}</a>
  <!-- If page belongs to a collection (cases, blog, insights...) -->
  {% if page.collection %}
    {% assign collection_name = page.collection %}
    {% assign collection_label = t.labels[collection_name] | default: collection_name %}
    <p class="breadcrumb-separator">/</p>
    <a href="{% if lang == 'es' %}/es/{{ collection_name }}/{% else %}/{{ collection_name }}/{% endif %}">{{ collection_label }}</a>
    {% unless page.url contains collection_name and page.url == '/' | append: collection_name | append: '/' %}
      <p class="breadcrumb-separator">/</p>
      <p class="breadcrumb-current">
        {{ page.title }}
      </p>
    {% endunless %}
  {% else %}
  <!-- If it's a normal page (like /cases/ or /about/) -->
    {% assign segments = page.url | split: '/' %}
    {% for segment in segments %}
      {% unless segment == "" or segment == "es" %}
        {% assign path = "/" | append: segment | append: "/" %}
        {% if lang == "es" %}
          {% assign path = "/es" | append: path %}
        {% endif %}
        {% assign page_match = site.pages | where: "url", path | first %}
        {% if page_match %}
          <p class="breadcrumb-separator">/</p>
          {% if page_match.url == page.url %}
            <p class="breadcrumb-current">{{ page_match.title }}</p>
          {% else %}
            <a href="{{ page_match.url | relative_url }}">{{ page_match.title }}</a>
          {% endif %}
        {% endif %}
      {% endunless %}
    {% endfor %}
  {% endif %}
</nav>